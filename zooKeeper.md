



>
>
> 分布式协调技术主要用来解决分布式环境当中多个进程之间的同步控制，让他们有序的去访问某种临界资源，防止造成“脏数据”的后果



#### 分布式环境网络不可靠

+ 在同一台机器上，你对一个服务的调用如果成功，那就是成功，如果调用失败，比如抛出异常那就是调用失败。但是在分布式环境中，由于网络的不可靠，你对一个服务的调用失败了并不表示一定是失败的，可能是执行成功了，但是响应返回的时候失败了。
+ 如果A和B都去调用C服务，最后的结果也不一定是A的请求先于B的请求



#### ZooKeeper

> ZooKeeper是一种为分布式应用所设计的高可用、高性能且一致的开源协调服务，它提供了一项基本服务：`分布式锁服务` 。由于ZooKeeper的开源特性，后来开发者在分布式锁的基础上，摸索出了其他的使用方法：`配置维护` 、`组服务` 、`分布式消息队列` 、`分布式通知/协调` 等



#### Znode

ZooKeeper的数据模型在结构上和标准文件系统非常相似，ZooKeeper树中的每个节点被称为Znode

![](D:\note\image\Znode.png)

+ Znode通过路径引用，路径必须是决对的，因此他们必须有斜杠字符来开头。除此之外，他们必须是唯一的
+ Znode兼具文件和目录两种特点。既像文件一样维护着数据、元信息、ACL、时间戳等数据结构，又像目录一样可以作为路径标识的一部分。Znode用来管理调度数据，比如分布式应用中的配置文件信息、状态信息、汇集位置等等。Znode的数据大小至多1M，但常规使用中应该远小于此值
  + stat：状态信息，描述该Znode的版本、权限等信息
  + data：与该Znode关联的数据
  + children：该Znode下的节点



#### 单点故障

主从模式中，主节点发生故障时，那么整个系统都瘫痪了，称为单点故障

![](D:\note\image\单点故障.png)

![](D:\note\image\单点故障2.png)



传统解决方案

采用一个备用节点，定期向当前主节点发生ping包，主节点收到ping包以后向备用节点发送回复Ack，当备用节点收到回复的时候就会认为当前节点还活着，让他继续提供服务

![](D:\note\image\单点故障3.png)

![](D:\note\image\单点故障4.png)

存在隐患，在回复的时候网络发送故障，就会出现双Master情况



#### Master选举

![](D:\note\image\Master选举.png)

![](D:\note\image\Master选举2.png)

